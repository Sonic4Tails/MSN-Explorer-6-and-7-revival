<html>

<head><script src="//archive.org/includes/analytics.js?v=cf34f82" type="text/javascript"></script>
<script type="text/javascript">window.addEventListener('DOMContentLoaded',function(){var v=archive_analytics.values;v.service='wb';v.server_name='wwwb-app202.us.archive.org';v.server_ms=552;archive_analytics.send_pageview({});});</script>
<script type="text/javascript" src="/_static/js/bundle-playback.js?v=MzYkZ0TU" charset="utf-8"></script>
<script type="text/javascript" src="/_static/js/wombat.js?v=UHAOicsW" charset="utf-8"></script>
<script type="text/javascript">
  __wm.init("https://web.archive.org/web");
  __wm.wombat("http://autoupdate.msn.com/fixcorruptfavs.hta","20140519074926","https://web.archive.org/","web","/_static/",
	      "1400485766");
</script>
<link rel="stylesheet" type="text/css" href="/_static/css/banner-styles.css?v=S1zqJCYt" />
<link rel="stylesheet" type="text/css" href="/_static/css/iconochive.css?v=qtvMKcIJ" />
<!-- End Wayback Rewrite JS Include -->

<title>Fix for MSN Client Favorites - v1.04</title>
<!-- BEGIN WAYBACK TOOLBAR INSERT -->
<style type="text/css">
body {
  margin-top:0 !important;
  padding-top:0 !important;
  /*min-width:800px !important;*/
}
</style>
<script>__wm.rw(0);</script>
<div id="wm-ipp-base" lang="en" style="display:none;direction:ltr;">
<div id="wm-ipp" style="position:fixed;left:0;top:0;right:0;">
<div id="donato" style="position:relative;width:100%;">
  <div id="donato-base">
    <iframe id="donato-if" src="https://archive.org/includes/donate.php?as_page=1&amp;platform=wb&amp;referer=https%3A//web.archive.org/web/20140519074926/http%3A//autoupdate.msn.com/fixcorruptfavs.hta"
	    scrolling="no" frameborder="0" style="width:100%; height:100%">
    </iframe>
  </div>
</div><div id="wm-ipp-inside">
  <div id="wm-toolbar" style="position:relative;display:flex;flex-flow:row nowrap;justify-content:space-between;">
    <div id="wm-logo" style="/*width:110px;*/padding-top:12px;">
      <a href="/web/" title="Wayback Machine home page"><img src="/_static/images/toolbar/wayback-toolbar-logo-200.png" srcset="/_static/images/toolbar/wayback-toolbar-logo-100.png, /_static/images/toolbar/wayback-toolbar-logo-150.png 1.5x, /_static/images/toolbar/wayback-toolbar-logo-200.png 2x" alt="Wayback Machine" style="width:100px" border="0" /></a>
    </div>
    <div class="c" style="display:flex;flex-flow:column nowrap;justify-content:space-between;flex:1;">
      <form class="u" style="display:flex;flex-direction:row;flex-wrap:nowrap;" target="_top" method="get" action="/web/submit" name="wmtb" id="wmtb"><input type="text" name="url" id="wmtbURL" value="http://autoupdate.msn.com/fixcorruptfavs.hta" onfocus="this.focus();this.select();" style="flex:1;"/><input type="hidden" name="type" value="replay" /><input type="hidden" name="date" value="20140519074926" /><input type="submit" value="Go" />
      </form>
      <div style="display:flex;flex-flow:row nowrap;align-items:flex-end;">
		<div class="s" id="wm-nav-captures" style="flex:1;">
	  	  <a class="t" href="/web/20140519074926*/http://autoupdate.msn.com/fixcorruptfavs.hta" title="See a list of every capture for this URL">2 captures</a>
	  <div class="r" title="Timespan for captures of this URL">19 May 2014 - 10 Dec 2015</div>
	  </div>
	<div class="k">
	  <a href="" id="wm-graph-anchor">
	    <div id="wm-ipp-sparkline" title="Explore captures for this URL" style="position: relative">
	      <canvas id="wm-sparkline-canvas" width="675" height="27" border="0"></canvas>
	    </div>
	  </a>
	</div>
      </div>
    </div>
    <div class="n">
      <table>
	<tbody>
	  <!-- NEXT/PREV MONTH NAV AND MONTH INDICATOR -->
	  <tr class="m">
	    <td class="b" nowrap="nowrap">Apr</td>
	    <td class="c" id="displayMonthEl" title="You are here: 07:49:26 May 19, 2014">MAY</td>
	    <td class="f" nowrap="nowrap"><a href="https://web.archive.org/web/20151210131840/http://autoupdate.msn.com:80/fixcorruptfavs.hta" title="10 Dec 2015"><strong>Dec</strong></a></td>
	  </tr>
	  <!-- NEXT/PREV CAPTURE NAV AND DAY OF MONTH INDICATOR -->
	  <tr class="d">
	    <td class="b" nowrap="nowrap"><img src="/_static/images/toolbar/wm_tb_prv_off.png" alt="Previous capture" width="14" height="16" border="0" /></td>
	    <td class="c" id="displayDayEl" style="width:34px;font-size:22px;white-space:nowrap;" title="You are here: 07:49:26 May 19, 2014">19</td>
	    <td class="f" nowrap="nowrap"><a href="https://web.archive.org/web/20151210131840/http://autoupdate.msn.com:80/fixcorruptfavs.hta" title="13:18:40 Dec 10, 2015"><img src="/_static/images/toolbar/wm_tb_nxt_on.png" alt="Next capture" width="14" height="16" border="0" /></a></td>
	  </tr>
	  <!-- NEXT/PREV YEAR NAV AND YEAR INDICATOR -->
	  <tr class="y">
	    <td class="b" nowrap="nowrap">2013</td>
	    <td class="c" id="displayYearEl" title="You are here: 07:49:26 May 19, 2014">2014</td>
	    <td class="f" nowrap="nowrap"><a href="https://web.archive.org/web/20151210131840/http://autoupdate.msn.com:80/fixcorruptfavs.hta" title="10 Dec 2015"><strong>2015</strong></a></td>
	  </tr>
	</tbody>
      </table>
    </div>
    <div class="r" style="display:flex;flex-flow:column nowrap;align-items:flex-end;justify-content:space-between;">
      <div id="wm-btns" style="text-align:right;height:23px;">
        	<span class="xxs">
          <div id="wm-save-snapshot-success">success</div>
          <div id="wm-save-snapshot-fail">fail</div>
          <a id="wm-save-snapshot-open" href="#"
	     title="Share via My Web Archive" >
            <span class="iconochive-web"></span>
          </a>
          <a href="https://archive.org/account/login.php" title="Sign In" id="wm-sign-in">
            <span class="iconochive-person"></span>
          </a>
          <span id="wm-save-snapshot-in-progress" class="iconochive-web"></span>
	</span>
        	<a class="xxs" href="http://faq.web.archive.org/" title="Get some help using the Wayback Machine" style="top:-6px;"><span class="iconochive-question" style="color:rgb(87,186,244);font-size:160%;"></span></a>
	<a id="wm-tb-close" href="#close" style="top:-2px;" title="Close the toolbar"><span class="iconochive-remove-circle" style="color:#888888;font-size:240%;"></span></a>
      </div>
      <div id="wm-share" class="xxs">
        <a href="/web/20140519074926/http://web.archive.org/screenshot/http://autoupdate.msn.com/fixcorruptfavs.hta"
           id="wm-screenshot"
           title="screenshot">
          <span class="wm-icon-screen-shot"></span>
        </a>
        <a href="#" id="wm-video" title="video">
          <span class="iconochive-movies"></span>
        </a>
	<a id="wm-share-facebook" href="#" data-url="https://web.archive.org/web/20140519074926/http://autoupdate.msn.com/fixcorruptfavs.hta" title="Share on Facebook" style="margin-right:5px;" target="_blank"><span class="iconochive-facebook" style="color:#3b5998;font-size:160%;"></span></a>
	<a id="wm-share-twitter" href="#" data-url="https://web.archive.org/web/20140519074926/http://autoupdate.msn.com/fixcorruptfavs.hta" title="Share on Twitter" style="margin-right:5px;" target="_blank"><span class="iconochive-twitter" style="color:#1dcaff;font-size:160%;"></span></a>
      </div>
      <div style="padding-right:2px;text-align:right;white-space:nowrap;">
	<a id="wm-expand" class="wm-btn wm-closed" href="#expand" onclick="__wm.ex(event);return false;"><span id="wm-expand-icon" class="iconochive-down-solid"></span> <span class="xxs" style="font-size:80%;">About this capture</span></a>
      </div>
    </div>
  </div>
    <div id="wm-capinfo" style="border-top:1px solid #777;display:none; overflow: hidden">
                    <div id="wm-capinfo-collected-by">
    <div style="background-color:#666;color:#fff;font-weight:bold;text-align:center">COLLECTED BY</div>
    <div style="padding:3px;position:relative" id="wm-collected-by-content">
            <div style="display:inline-block;vertical-align:top;width:50%;">
			<span class="c-logo" style="background-image:url(https://archive.org/services/img/webwidecrawl);"></span>
		Organization: <a style="color:#33f;" href="https://archive.org/details/webwidecrawl" target="_new"><span class="wm-title">Internet Archive</span></a>
		<div style="max-height:75px;overflow:hidden;position:relative;">
	  <div style="position:absolute;top:0;left:0;width:100%;height:75px;background:linear-gradient(to bottom,rgba(255,255,255,0) 0%,rgba(255,255,255,0) 90%,rgba(255,255,255,255) 100%);"></div>
	  The Internet Archive discovers and captures web pages through many different web crawls.

At any given time several distinct crawls are running, some for months, and some every day or longer.

View the web archive through the <a href="http://archive.org/web/web.php">Wayback Machine</a>.
	</div>
	      </div>
      <div style="display:inline-block;vertical-align:top;width:49%;">
			<span class="c-logo" style="background-image:url(https://archive.org/services/img/liveweb)"></span>
		<div>Collection: <a style="color:#33f;" href="https://archive.org/details/liveweb" target="_new"><span class="wm-title">Live Web Proxy Crawls</span></a></div>
		<div style="max-height:75px;overflow:hidden;position:relative;">
	  <div style="position:absolute;top:0;left:0;width:100%;height:75px;background:linear-gradient(to bottom,rgba(255,255,255,0) 0%,rgba(255,255,255,0) 90%,rgba(255,255,255,255) 100%);"></div>
	  Content crawled via the <a href="http://archive.org/web/web.php">Wayback Machine</a> Live Proxy mostly by the Save Page Now feature on web.archive.org.
<br><br>
Liveweb proxy is a component of Internet Archiveâ€™s wayback machine project. The liveweb proxy captures the content of a web page in real time, archives it into a ARC or WARC file and returns the ARC/WARC record back to the wayback machine to process. The recorded ARC/WARC file becomes part of the wayback machine in due course of time.
<br>
	</div>
	      </div>
    </div>
    </div>
    <div id="wm-capinfo-timestamps">
    <div style="background-color:#666;color:#fff;font-weight:bold;text-align:center" title="Timestamps for the elements of this page">TIMESTAMPS</div>
    <div>
      <div id="wm-capresources" style="margin:0 5px 5px 5px;max-height:250px;overflow-y:scroll !important"></div>
      <div id="wm-capresources-loading" style="text-align:left;margin:0 20px 5px 5px;display:none"><img src="/_static/images/loading.gif" alt="loading" /></div>
    </div>
    </div>
  </div></div></div></div><div id="wm-ipp-print">The Wayback Machine - https://web.archive.org/web/20140519074926/http://autoupdate.msn.com/fixcorruptfavs.hta</div>
<script type="text/javascript">//<![CDATA[
__wm.bt(675,27,25,2,"web","http://autoupdate.msn.com/fixcorruptfavs.hta","20140519074926",1996,"/_static/",["/_static/css/banner-styles.css?v=S1zqJCYt","/_static/css/iconochive.css?v=qtvMKcIJ"], false);
  __wm.rw(1);
//]]></script>
<!-- END WAYBACK TOOLBAR INSERT --><hta:application applicationname="Favorites Fix" scroll="no" singleinstance="yes" maximizebutton="no" singleinstance="yes" icon="http://hp.msn.com/global/c/hpv10/favicon.ico" border="thin">
<script language="VBScript">

sub window_onLoad
   window.resizeTo 550,300
end sub

Dim strUsrNm, strPswd
Dim strFavFileContent

Function MakeReq (strVerb, strURL , strData, strErrorCode)
    'on error resume next 
    
    Dim HttpReq
    set HttpReq = CreateObject("MSXML2.XMLHTTP")
   
    HttpReq.open strVerb, strURL, false, "", ""
    
    if strVerb <> "GET" then
        HttpReq.setRequestHeader "Content-Type","text/xml"
        HttpReq.setRequestHeader "Application","Mars"
        if strVerb = "PROPFIND" then
            HttpReq.setRequestHeader "Depth","1"
        elseif strVerb = "PUT" then
            HttpReq.setRequestHeader "Accept", "*/*"
            HttpReq.setRequestHeader "UA-CPU", "x86"
            HttpReq.setRequestHeader "Accept-Encoding", "gzip, deflate"
            HttpReq.setRequestHeader "User-Agent", "Mozilla/4.0 (compatible; MSIE 7.0; Windows NT 5.2; EmbeddedWB 14.52 from: http://www.bsalsa.com/ EmbeddedWB 14.52; .NET CLR 1.1.4322; InfoPath.2; .NET CLR 1.0.3705; .NET CLR 3.0.04506.30; .NET CLR 2.0.50727; MS-RTC LM 8; MSN Optimized;BE; MSN Optimized;US;  MSN 9.0;MSN 9.1; MSNbMSNI; MSNmen-us; MSNcIA)"
        end if
    end if
    
    if strData <> "" then
        HttpReq.send strData
    else
        HttpReq.send
    end if

    strErrorCode = HttpReq.status
    MakeReq = HttpReq.responseText
end function

Function IsSupportedVersion()
on error resume next
    Dim bRetValue
    Dim strManifest
    Dim objFSO
    Dim objWShell
    Dim strMSNCoreFiles 
    Dim objXml  
    Dim strVersion
    Dim arrVersion
     
    Set objWShell = null
    Set objXml = null
    Set objFSO = null
    bRetValue = false
    
    Set objWShell = CreateObject("WScript.Shell")
    Set objFSO = CreateObject("Scripting.FileSystemObject")
    Set objXml = CreateObject("Msxml2.FreeThreadedDOMDocument")    
    
    err.clear
    strMSNCoreFiles = objWShell.RegRead("HKEY_LOCAL_MACHINE\SOFTWARE\Microsoft\MSN6\Setup\MSN\InstallDir")
    if err.number <> 0 then
        MsgBox "Unable to determine the version number of MSN Explorer.", vbExclamation, "Fix for MSN Client Favorites - v1.04"
        IsSupportedVersion = bRetValue  
        exit function
    end if
    
    strManifest = strMSNCoreFiles & "\manifest.xml"
    strVersion = ""
    
    if (objFSO.FileExists(strManifest)) then
        err.clear
        objXml.load strManifest
        strVersion = objXml.selectSingleNode("//web.archive.org/web/20140519074926/http://package/Files/@Version").text
    else
        MsgBox "Unable to determine the version number of MSN Explorer.", vbExclamation, "Fix for MSN Client Favorites - v1.04"
        IsSupportedVersion = bRetValue  
        exit function    
    end if
    
    if err.number <> 0 then
        MsgBox "Unable to determine the version number of MSN Explorer.", vbExclamation, "Fix for MSN Client Favorites - v1.04"
        IsSupportedVersion = bRetValue  
        exit function
    end if
   
    arrVersion = Split(strVersion,".")
    
    if ((9 > arrVersion(0)) or ((60 > arrVersion(1)) and (9 = arrVersion(0)))) then             
        MsgBox "This version of MSN Explorer is not supported.", vbExclamation, "Fix for MSN Client Favorites - v1.04"                
    else
        bRetValue = true
    end if
    IsSupportedVersion = bRetValue    
End Function

Sub FixCorruptFavorite()
	on error resume next

	Dim objWSHShell
	Dim objWSHSpecialFolders
	Dim strPath
	Dim objFSO
	Dim objFolder
	Dim strFinalPath
	Dim strFolderName
	dim strErrorCode
	
	strUsrNm = ""
	strPswd = ""
    Dim rootURL, MSNURL, DAVURL, PartnerURL
    Dim xmlDoc, xmlNode, strCookies
    Dim strHeadears
    Dim authpos, profpos, authlen, proflen
    Dim strRespData
    Dim FavURL
    Dim objXml
    Dim iStartIndex
    
    
    msgbox "To run the tool successfully, please ensure MSN software is not currently running." & vbCrLf & "Please make sure that you are still connected to the Internet.", vbInformation,"Fix for MSN Client Favorites - v1.04"
        
    btnFix.disabled = true
    btnFix.value = "Do not close the application..."
    strUsrNm = txtUser.value
    strPswd = txtPswd.value    
    
    if strUsrNm = "" or strPswd="" then
        MsgBox "Please enter your User Name and Password",vbCritical,"Fix for MSN Client Favorites - v1.04"
        btnFix.value = "Click here to login and fix your favorites"
        btnFix.disabled = false
        exit sub
    end if
    
    if false = IsSupportedVersion() then
         btnFix.value = "Click here to login and fix your favorites"
         btnFix.disabled = false
         exit sub
    end if    
    
    PartnerURL = "https://web.archive.org/web/20140519074926/https://login.live.com/ppsecure/clientpost.srf?id=2595&RU=http%3A%2F%2Flogin.msn.com%2Fpassport%2F"
    MSNURL = "https://web.archive.org/web/20140519074926/https://msnia.login.live.com/ppsecure/clientpost.srf?id=2595&RU=http%3A%2F%2Flogin.msn.com%2Fpassport%2F"
    StorageURL = "https://web.archive.org/web/20140519074926/http://www.storage.msn.com/"
    strMSNLogin = "https://web.archive.org/web/20140519074926/http://login.msn.com/passport/?did=1&" 
    data="<LoginRequest><ClientInfo name='PassportClient' version='1.35'/><User><SignInName>" & strUsrNm & "</SignInName><Password>" & strPswd & "</Password><SavePassword>false</SavePassword></User><DAOption>0</DAOption><TargetOption>1</TargetOption></LoginRequest>"

    if InStr(1,strUsrNm, "@msn.com") <> 0 then
        rootURL = MSNURL
    else
        rootURL = PartnerURL
    end if

    strRespData = MakeReq ("POST", rootURL, data, strErrorCode)
    set xmlDoc = CreateObject("Msxml2.FreeThreadedDOMDocument")
    xmlDoc.loadXML strRespData

    dim posBegin, strValue, posEnd
    posBegin = InStr(1,strRespData,"Success=""")
    if posBegin <> 0 then
        posBegin = posBegin + 9
        posEnd = InStr(posBegin,strRespData,"""") 
        strValue = Mid(strRespData, posBegin, posEnd - posBegin)
        if strValue = "false" then
            posBegin = InStr(posBegin, strRespData, "Code=""")
            posBegin = posBegin + 6
            posEnd = InStr(posBegin, strRespData, """")
            strValue = Mid(strRespData, posBegin, posEnd - posBegin)
            if strValue = "e12" then
                MsgBox "To fix favorites for a different user, please close this application and run it again.", vbExclamation, "Fix for MSN Client Favorites - v1.04"
            else
                MsgBox "Invalid User Name and/or Password", vbCritical,"Fix for MSN Client Favorites - v1.04" 
            end if
            btnFix.value = "Click here to login and fix your favorites"
            btnFix.disabled = false
            exit sub
        end if
    end if

    
    strMSNLogin = strMSNLogin  & xmlDoc.selectSingleNode("//web.archive.org/web/20140519074926/http://loginresponse/TnP").text
    
    strRespData = MakeReq ("GET", strMSNLogin, "", strErrorCode)
    
	FavURL = "https://web.archive.org/web/20140519074926/http://storage.msn.com/mydata/msnclient/favorites.xml"
    
	Set objWSHShell= CreateObject("WScript.Shell")
	Set objWSHSpecialFolders= objWSHShell.SpecialFolders
	strPath=objWSHSpecialFolders("AppData")+"\msn6\UserData"

	
	Set objFSO =CreateObject("Scripting.FileSystemObject")
	If Not objFSO.FolderExists(strPath) then
		Msgbox "Favorites Folder not found",vbExclamation,"Fix for MSN Client Favorites - v1.04"	
		btnFix.value = "Click here to login and fix your favorites"
        btnFix.disabled = false
		Exit Sub
	End if

    Dim strUserDataPath, strUserFavFile
    
    strUserDataPath = objWSHShell.RegRead("HKEY_CURRENT_USER\SOFTWARE\Microsoft\MSN6\Users\" & strUsrNm & "\GUID")
    if err.number <> 0 then
        MsgBox  strUsrNm & " is not set up as a Premium client user on this computer", vbCritical,"Fix for MSN Client Favorites - v1.04" 
        btnFix.value = "Click here to login and fix your favorites"
        btnFix.disabled = false
        exit sub
    end if
    strUserFavFile = strPath & "\" & strUserDataPath & "\favorites.xml"
    strFinalPath = strPath & "\" & strUserDataPath

	If (objFSO.FileExists(strUserFavFile)) then
	    FixCorruption strFinalPath,strUserFavFile
	
	    if (err.number<>0) then 
            MsgBox "Error occurred while fixing the favorite(" + Err.Description + ")", vbCritical, "Fix for MSN Client Favorites - v1.04"
        else
            set objXml = CreateObject("Msxml2.FreeThreadedDOMDocument")
            objXml.load(strUserFavFile)
	        if((err.number <> 0) or (objXml.xml = "")) then	            
	            MsgBox "Error in loading the favorites file", vbCritical, "Fix for MSN Client Favorites - v1.04"
	            btnFix.value = "Click here to login and fix your favorites"
                btnFix.disabled = false
	            exit sub	                        
	        end if      	    
	        strFavFileContent = objXml.xml
	        iStartIndex = -1
            iStartIndex = InStr(1,strFavFileContent,"<?xml version=""1.0""?>")
            
            if 0 < iStartIndex then
                iStartIndex = InStr(1, strFavFileContent, ">") + 1
                strFavFileContent = "<?xml version=""1.0"" encoding=""utf-8""?>" & Mid(strFavFileContent, iStartIndex)       
            end if
    	    
            MakeReq "PUT", FavURL, strFavFileContent, strErrorCode
            
            if strErrorCode <> "201" and strErrorCode <> "200" and strErrorCode <> "204" then 'If return code is not Success then notify user
                MsgBox  "Error Code - " & strErrorCode & vbCrLf & "Could not update server with fixed favorites information" & vbCrLf & "Please try again later.", vbExclamation,"Fix for MSN Client Favorites - v1.04" 
                btnFix.value = "Click here to login and fix your favorites"
                btnFix.disabled = false
                exit sub
            end if
	        MsgBox "Successfully fixed the favorites file. Please sign in to client and view the favorites", vbInformation, "Fix for MSN Client Favorites - v1.04"
        end if
    else
        MsgBox "No Favorites file exist for this user", vbInformation, "Fix for MSN Client Favorites - v1.04"
    end if
    btnFix.value = "Click here to login and fix your favorites"
    btnFix.disabled = false

End Sub

Sub BackupFavorite(strFinalPath)
	on error resume next
	Dim objFSO
	Dim strSourceFile
	Dim strDestFile
	Dim intbackup
	Set objFSO =CreateObject("Scripting.FileSystemObject")	

	intbackup=1
	do while true
		strDestFile= strFinalPath + "\favorites_bak_" + cstr(intbackup) + ".xml"
		if Not objFSO.FileExists(strDestFile) Then exit do
		intbackup=intbackup+1
	loop
	strSourceFile = strFinalPath + "\favorites.xml"
	objFSO.CopyFile strSourceFile,strDestFile,true

End Sub

Function SaveXmlToFile(strFinalFilePath, strResponse)
    dim objXMLDoc
    dim objFSO
    set objXMLDoc = CreateObject("Msxml2.FreeThreadedDOMDocument")
    Set objFSO = CreateObject("Scripting.FileSystemObject")
    objXMLDoc.loadXML(strResponse)
    if (objFSO.FileExists(strFinalFilePath)) then
        objFSO.DeleteFile strFinalFilePath, true
    end if
    objXMLDoc.save(strFinalFilePath)    
End Function 

Sub FixCorruption(strPath,strFinalPath)
	on error resume next
	Dim objFSO
	Dim strContent
	Dim intIndex
	Dim intFinalIndex
	Dim objFS
	Dim strOrgContent
		
	Set objFSO = CreateObject("Scripting.FileSystemObject")
	Set objFS = objFSO.OpenTextFile(strFinalPath,1)
	if Err.number <> 0 Then
	    MsgBox  "Could not locate local favorites file", vbCritical,"Fix for MSN Client Favorites - v1.04" 
	    Exit Sub
	End If 
	strContent = objFS.ReadAll
	strOrgContent = strContent
	objFS.close
	
	intIndex = Instr(1,strContent,"<?xml version")
	if (intIndex<=0) then
	    strContent="<?xml version=""1.0"" encoding=""utf-8""?>" + strContent
	end if
	
	intIndex = Instr(1,strContent,"<?xml version=""1.0""?>")
	if (intIndex>0) then
	    strContent = Replace(strContent,"<?xml version=""1.0""?>","<?xml version=""1.0"" encoding=""utf-8""?>")		
	end if
	
	intIndex = InStr(1,strContent,"<!DOCTYPE")
	if (intIndex > 0) then
	    intFinalIndex = InStr(intIndex + 1, strContent, ">")
	    if (intFinalIndex > 0) then
	        strContent = Mid(strContent, 1, intIndex - 1) + Mid(strContent, intFinalIndex + 1)	        
	    end if 
	end if
	
	
	intIndex = Instr(1,strContent,"<head>")
	if (intIndex>0) then
		intFinalIndex = Instr(1,strContent,"</head>")
		if (intFinalIndex>0) then
			strContent = Mid(strContent,1,intIndex-1) + Mid(strContent,intFinalIndex+7)
		end if
	end if

	intIndex = Instr(1,strContent,"<body")
	if (intIndex>0) then
		intFinalIndex = Instr(intIndex,strContent,"</body>")
		if (intFinalIndex>0) then
			strContent = Mid(strContent,1,intIndex-1) + Mid(strContent,intFinalIndex+7)
		end if
	end if

	intIndex = Instr(1,strContent, "<html sortedby")
	if (intIndex>0) then
		strContent = Replace(strContent,"<html sortedby","<favorites sortedby")
	end if
	intIndex = Instr(1,strContent, "<html showthumbs")
	if (intIndex>0) then
		strContent = Replace(strContent,"<html showthumbs","<favorites showthumbs")
	end if
	intIndex = Instr(1,strContent, "<html showurls")
	if (intIndex>0) then
		strContent = Replace(strContent,"<html showurls","<favorites showurls")
	end if
	intIndex = Instr(1,strContent, "<html direction")
	if (intIndex>0) then
		strContent = Replace(strContent,"<html direction","<favorites direction")
	end if
	intIndex = Instr(1,strContent, "<html showfeatured")
	if (intIndex>0) then
		strContent = Replace(strContent,"<html showfeatured","<favorites showfeatured")
	end if
	intIndex = Instr(1,strContent, "<html>")
	if (intIndex>0) then
		strContent = Replace(strContent,"<html>","<favorites>")
	end if		
	intIndex = Instr(1,strContent, "<html xmlns=""http://www.w3.org/1999/xhtml""")
	
	if (intIndex>0) then
		strContent = Replace(strContent,"<html xmlns=""http://www.w3.org/1999/xhtml""","<favorites")
	end if	

	intIndex = Instr(1,strContent, "</html>")
	if (intIndex>0) then
		strContent = Replace(strContent,"</html>","</favorites>")
	end if
	strContent = FixIDCorruption(strcontent)

'	strContent = FixSpecialCharacters(strContent)

	BackupFavorite strPath
	strFavFileContent = ""
    strFavFileContent = strContent
    'SaveXmlToFile strFinalPath, strContent
    on error resume next
	
	Set objFS=objFSO.CreateTextFile (strFinalPath, true)
	objFS.write strContent	
	objFS.close
End Sub

Function FixIDCorruption(strContent)
    Dim intIndex
    Dim intFinalIndex

    intIndex = 1
    Do While True
        intIndex = InStr(intIndex, strContent, "id=""(")
        If (intIndex <= 0) Then Exit Do
        intFinalIndex = InStr(intIndex + 5, strContent, """>")
        strContent = Mid(strContent, 1, intIndex - 1) + "id=""" + GetGUID() + """>" + Mid(strContent, intFinalIndex + 2)
        intIndex = intIndex + 45
    Loop
    FixIDCorruption = strContent
End Function

function GetGUID()

	Dim TypeLib
	Dim strFinalValue
	Dim intIndex
	Dim strValue
	
	Set TypeLib = CreateObject("Scriptlet.TypeLib")
	strFinalValue = cstr(TypeLib.Guid)
	intIndex = InstrRev(strFinalValue,"}")
	if (intIndex <=0) Then 
		GetGUID="{06C8F26C-1E26-01C7-0200-0000AEA3C784}" //provide dummy GUID
		exit function	
	end if
	strValue = Left(strFinalValue,intIndex)
	GetGUID= strValue

end function

function FixSpecialCharacters(strContent)
	
	Dim intIndex
	Dim strOrgContent

	strOrgContent = strcontent
	strContent = Replace(strcontent,"&amp;","!@#$%*")
	intIndex = Instr(1,strContent,"&")
	if (intIndex<=0) then
		FixSpecialCharacters=strOrgContent
		Exit Function
	end if	
	strContent = Replace(strcontent,"&","&amp;")
	strContent = Replace(strContent,"!@#$%*","&amp;") 

	FixSpecialCharacters=strContent
	

End function

</script>
<script type="text/javascript">
function HandleEnter()
{
    if(event.keyCode==13)
    {
        document.getElementById("btn").click();
    }
}
</script> 

</head>
<body bgcolor="#000066" style="overflow: hidden; width: 360px; height: 250px;">
<table border="0" cellpadding="3">
<tr><td rowspan="5"><img id="imgbtfly" src="https://web.archive.org/web/20140519074926im_/http://www.msn.fr/img/fr/fr-fr/msn8/sas/homepage_butterfly.jpg"></td></tr>
<tr><td valign="bottom"><font color="white"> User name :</font></td><td valign="bottom"><input type="text" name="txtUser" value="" unselectable="off" style="width: 198px" onkeydown="HandleEnter()"/></td></tr>
<tr><td valign="top" align="center" colspan="2"><font color="white">Example: abc@msn.com</font></td></tr>
<tr><td valign="top"><font color="white"> Password :</font></td><td valign="top"><input type="password" name="txtPswd" value="" style="width: 199px" onkeydown="HandleEnter()"/></td></tr>
<tr><td valign="center" align="center" colspan="2"><input type="button" id="btn" name="btnFix" value="Click here to login and fix your favorites" onclick="FixCorruptFavorite()" style="overflow: hidden; width: 275px; height: 32px; background-color: LightSteelBlue"></td></tr>   
</table>
</body>
<!--
     FILE ARCHIVED ON 07:49:26 May 19, 2014 AND RETRIEVED FROM THE
     INTERNET ARCHIVE ON 19:11:26 Nov 22, 2022.
     JAVASCRIPT APPENDED BY WAYBACK MACHINE, COPYRIGHT INTERNET ARCHIVE.

     ALL OTHER CONTENT MAY ALSO BE PROTECTED BY COPYRIGHT (17 U.S.C.
     SECTION 108(a)(3)).
-->
<!--
playback timings (ms):
  captures_list: 458.341
  exclusion.robots: 0.136
  exclusion.robots.policy: 0.13
  cdx.remote: 0.056
  esindex: 0.02
  LoadShardBlock: 246.291 (3)
  PetaboxLoader3.datanode: 89.163 (4)
  CDXLines.iter: 21.263 (3)
  PetaboxLoader3.resolve: 160.266 (2)
  load_resource: 90.101
-->